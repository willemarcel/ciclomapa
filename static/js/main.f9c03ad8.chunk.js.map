{"version":3,"sources":["img/itdp.png","img/ucb.png","img/light.png","img/normal.png","img/satelite.png","Map.js","constants.js","Spinner.js","CitySwitcherBackdrop.js","TopBar.js","MapStyleSwitcher.js","LayersPanel.js","utils.js","OSMController.js","geojsonUtils.js","Storage.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","map","popup","selectedCycleway","MAPBOX_ACCESS_TOKEN","DEFAULT_LNG","DEFAULT_LAT","geocodingClient","mbxGeocoding","accessToken","Map","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","onMapMoved","bind","assertThisInitialized","e","console","debug","features","coords","lngLat","properties","layer","layers","find","l","id","split","html","name","concat","setLngLat","setHTML","addTo","remove","sw","getBounds","getSouthWest","ne","getNorthEast","lat","lng","_this2","reverseGeocode","query","types","limit","send","then","response","body","place","once","setMaxBounds","bbox","area","place_name","catch","err","error","message","getCenter","zoom","getZoom","_this3","filters","toConsumableArray","f","f2","style","borderColor","addLayer","type","source","description","paint","objectSpread","line-color","line-width","lineWidth","borderStyle","line-dasharray","filter","lineColor","borderWidth","lineStyle","interactiveId","on","length","getCanvas","cursor","setFeatureState","highlight","showPopup","_this4","addSource","data","generateId","slice","reverse","forEach","addDynamicLayer","prevProps","getSource","setData","setStyle","center","setCenter","isActive","join","setLayoutProperty","_this5","mapboxgl","container","mapContainer","searchBar","MapboxGeocoder","language","placeholder","countries","addControl","cityPicker","marker","clearOnBlur","result","document","querySelector","classList","clear","NavigationControl","showCompass","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","initLayers","Popup","closeOnClick","_this6","react_default","a","createElement","ref","el","Component","Spinner","city","className","fontSize","role","aria-label","viewBox","cx","cy","r","fill","strokeWidth","strokeMiterlimit","CitySwitcherBackdrop","onClick","onClose","es_button","size","TopBar","Modal","info","title","content","href","target","rel","src","itdp","alt","ucb","onOk","add","focus","get","set","updatedAt","parts","state","isDownloadUnavailable","lastUpdate","toLocaleString","height","showCityPicker","icon","color","popover","placement","forceUpdate","marginLeft","arrowPointAtCenter","divider","downloadData","disabled","opacity","MapStyleSwitcher","selected","options","img","normal","url","light","satelite","prevState","onMapStyleChange","option","i","setState","key","LayersPanel","newVal","onLayersChange","tooltip","onChange","background","borderLeft","borderRight","es_switch","checked","slugify","str","RegExp","toString","toLowerCase","replace","c","charAt","indexOf","typeSizes","undefined","boolean","number","string","item","object","keys","reduce","total","sizeOf","value","servers","OSMController","constraints","areaId","f_inner","massageLayersData","Promise","resolve","reject","geoJson","$","getJSON","encodeURI","nominatimData","osm_id","getQuery","encodedQuery","requests","_loop","endpoint","elements","abort","osmtogeojson","flatProperties","isLastRemainingRequest","status","fail","statusText","notification","DEBUG","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","Storage","firebase","initializeApp","db","firestore","collection","querySnapshot","doc","compressed","pako","deflate","JSON","stringify","to","gzipCompress","jsonStr","part","slug","saveToFirestore","part1","Math","ceil","part2","exists","buffer","getDataFromDB","parse","toDate","App","updateData","urlParams","getParamsFromURL","loading","getLayers","mapStyle","z","parseFloat","storage","URLSearchParams","location","search","paramsObj","Date","getData","now","save","dataUpdatedAt","force","getDataFromOSM","load","isDataFresh","newMapStyle","newLayers","assign","feature","match","partsToMatch","propertyKey","cleanUpOSMTags","fileName","blob","Blob","saveAs","downloadObjectAsJson","onRouteChanged","params","toFixed","history","push","newState","src_TopBar_0","src_CitySwitcherBackdrop_0","src_Map_0","src_MapStyleSwitcher_0","src_LayersPanel_0","src_Spinner_0","withRouter","Boolean","window","hostname","ReactDOM","render","react_router_dom","src_App_0","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.f9c03ad8.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/itdp.c441e7e0.png\";","module.exports = __webpack_public_path__ + \"static/media/ucb.8a36a689.png\";","module.exports = __webpack_public_path__ + \"static/media/light.aead2e19.png\";","module.exports = __webpack_public_path__ + \"static/media/normal.e409dcfc.png\";","module.exports = __webpack_public_path__ + \"static/media/satelite.a853a709.png\";","import React, { Component } from 'react';\n\nimport mapboxgl from 'mapbox-gl'\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder'\nimport '@mapbox/mapbox-gl-geocoder/dist/mapbox-gl-geocoder.css'\n\nimport mbxGeocoding from '@mapbox/mapbox-sdk/services/geocoding';\n\nimport { MAPBOX_ACCESS_TOKEN } from './constants.js'\n\nimport './Map.css'\n\n\nlet map, popup;\nlet selectedCycleway;\n\nconst geocodingClient = mbxGeocoding({ accessToken: MAPBOX_ACCESS_TOKEN });\n\n\nclass Map extends Component {\n    constructor(props) {\n        super(props);\n\n        this.onMapMoved = this.onMapMoved.bind(this);\n    }\n\n    showPopup(e) {\n        console.debug(e.features[0]);\n\n        const coords = e.lngLat;\n        const props = e.features[0].properties;\n\n        const layer = this.props.layers.find(l =>\n            l.id === e.features[0].layer.id.split('--')[0]\n        );\n\n        let html = '';\n\n        if (props.name) {\n            html += `<h2>${props.name}</h2>`;\n        } else {\n            html += '<i>Sem nome</i>';\n        }\n        \n        html += `<p>Tipo: <b>${layer.name}</b></p>`;\n\n        // html += `<h3>Tipo: ${layer.name}</h3>`;\n        // html += `<p>${layer.description}</p>`;\n\n        // const prettyProps = JSON.stringify(props, null, 2)\n        //     .replace(/(?:\\r\\n|\\r|\\n)/g, '<br/>')\n        //     .replace(/\"|,|\\{|\\}/g, '');\n        // html += prettyProps;\n\n        html += `\n            <a\n                target=\"_BLANK\"\n                rel=\"noopener\"\n                href=\"https://www.openstreetmap.org/${props.id}\"\n            >\n                Editar no OSM\n            </a>\n    `;\n\n        popup.setLngLat(coords)\n            .setHTML(html)\n            .addTo(map);\n    }\n\n    hidePopup() {\n        popup.remove();\n    }\n\n    // southern-most latitude, western-most longitude, northern-most latitude, eastern-most longitude\n    getCurrentBBox() {\n        const fallback = \"-23.036345361742164,-43.270405878917785,-22.915284125684607,-43.1111041211104\";\n\n        if (map) {\n            const sw = map.getBounds().getSouthWest();\n            const ne = map.getBounds().getNorthEast();\n            return `${sw.lat},${sw.lng},${ne.lat},${ne.lng}`;\n        } else {\n            return fallback;\n        }\n    }\n\n    reverseGeocode(lngLat) {\n        geocodingClient\n            .reverseGeocode({\n                query: lngLat,\n                types: ['place'],\n                limit: 1\n            })\n            .send()\n            .then(response => {\n                const features = response.body.features;\n\n                console.debug('reverseGeocode', features);\n\n                if (features && features[0]) {\n                    const place = features[0];\n\n                    console.debug('once moveend...');\n\n                    map.once('moveend', () => {\n                        console.debug('moveend');\n                        map.setMaxBounds([\n                            [place.bbox[0]-0.15, place.bbox[1]-0.15], // Southwest coordinates\n                            [place.bbox[2]+0.15, place.bbox[3]+0.15]  // Northeast coordinates\n                        ]); \n                    });\n                    \n                    this.props.onMapMoved({area: place.place_name});\n                }\n            })\n            .catch(err => {\n                console.error(err.message);\n            });\n    }\n\n    onMapMoved() {\n        const lat = map.getCenter().lat;\n        const lng = map.getCenter().lng;\n        const zoom = map.getZoom();\n\n        this.props.onMapMoved({\n            lat: lat,\n            lng: lng,\n            zoom: zoom,\n        });\n    }\n\n    addDynamicLayer(l) {\n        const filters = [\n            \"any\",\n            ...l.filters.map(f => \n                typeof f[0] === 'string' ?\n                    [\"==\", [\"get\", f[0]], f[1]]\n                    :\n                    [ \"all\",\n                        ...f.map(f2 =>\n                            [\"==\", [\"get\", f2[0]], f2[1]]\n                        )\n                    ]\n                )\n        ];\n\n        // const layers = map.getStyle().layers;\n        // // Find the index of the first symbol layer in the map style\n        // let firstSymbolId;\n        // for (var i = 0; i < layers.length; i++) {\n        //     if (layers[i].type === 'symbol') {\n        //         firstSymbolId = layers[i].id;\n        //         break;\n        //     }\n        // }\n\n        // Check if layer has a border color set. If that's the case the logic is a\n        //  little different and we'll need 2 layers, one for the line itself and \n        //  another for the line underneath which creates the illusion of a border.\n        if (l.style.borderColor) {\n            // Border\n            map.addLayer({\n                \"id\": l.id+'--border',\n                \"type\": \"line\",\n                \"source\": \"osm\",\n                \"name\": l.name,\n                \"description\": l.description,\n                \"paint\": {\n                    \"line-color\": l.style.borderColor,\n                    \"line-width\": [\n                        \"interpolate\",\n                            [\"exponential\", 1.5],\n                            [\"zoom\"],\n                            12, l.style.lineWidth,\n                            18, l.style.lineWidth*3\n                    ],\n                    ...(l.style.borderStyle === 'dashed' && {'line-dasharray': [1, 0.6]})\n                },\n                \"filter\": filters,\n            // }, firstSymbolId);\n            });\n\n            // Line\n            map.addLayer({\n                \"id\": l.id,\n                \"type\": \"line\",\n                \"source\": \"osm\",\n                \"name\": l.name,\n                \"description\": l.description,\n                \"paint\": {\n                    \"line-color\": l.style.lineColor,\n                    \"line-width\": [\n                        \"interpolate\",\n                            [\"exponential\", 1.5],\n                            [\"zoom\"],\n                            12, (l.style.lineWidth - l.style.borderWidth),\n                            18, (l.style.lineWidth - l.style.borderWidth)*3\n                    ],\n                    ...(l.style.lineStyle === 'dashed' && {'line-dasharray': [1, 0.6]})\n                },\n                \"filter\": filters,\n            // }, firstSymbolId);\n            });\n        } else {\n            map.addLayer({\n                \"id\": l.id,\n                \"type\": \"line\",\n                \"source\": \"osm\",\n                \"name\": l.name,\n                \"description\": l.description,\n                \"paint\": {\n                    \"line-color\": l.style.lineColor,\n                    \"line-width\": [\n                        \"interpolate\",\n                            [\"exponential\", 1.5],\n                            [\"zoom\"],\n                            12, l.style.lineWidth,\n                            18, l.style.lineWidth*3\n                    ],\n                    ...(l.style.lineStyle === 'dashed' && {'line-dasharray': [1, 0.6]})\n                },\n                \"filter\": filters,\n            // }, firstSymbolId);\n            });\n        }\n\n        \n        // Interactions\n\n        const interactiveId = l.style.borderColor ? \n            l.id + '--border'\n            : l.id;\n\n        map.on(\"mouseenter\", interactiveId, e => {\n            if (e.features.length > 0) {\n                // Cursor\n                map.getCanvas().style.cursor = 'pointer';\n\n                // Hover style\n                // if (hoveredCycleway) {\n                //     map.setFeatureState({ source: 'osm', id: hoveredCycleway }, { highlight: false });\n                // }\n                // hoveredCycleway = e.features[0].id;\n                // map.setFeatureState({ source: 'osm', id: hoveredCycleway }, { highlight: true });\n            }\n        });\n\n        map.on(\"mouseleave\", interactiveId, e => {\n            // Hover style\n            // if (hoveredCycleway && !selectedCycleway) {\n                // map.setFeatureState({ source: 'osm', id: hoveredCycleway }, { highlight: false });\n\n                // Cursor cursor\n                map.getCanvas().style.cursor = '';\n            // }\n            // hoveredCycleway = null;\n        });\n\n        map.on(\"click\", interactiveId, e => {\n            if (e.features.length > 0) {\n                if (selectedCycleway) {\n                    map.setFeatureState({ source: 'osm', id: selectedCycleway }, { highlight: false });\n                }\n                selectedCycleway = e.features[0].id;\n                map.setFeatureState({ source: 'osm', id: selectedCycleway }, { highlight: true });\n\n                this.showPopup(e);\n            }\n        });\n    }\n\n    initLayers() {\n        map.addSource(\"osm\", {\n            \"type\": \"geojson\",\n            \"data\": this.props.data || {\n                'type': 'FeatureCollection',\n                'features': []\n            },\n            \"generateId\": true\n        });\n\n        // In GeoJSON layers are from most important to least important, but we \n        //   want the most important ones to be on top.\n        // Slice is used here to don't destructively reverse the original array.\n        this.props.layers.slice().reverse().forEach(l => {\n            this.addDynamicLayer(l);\n        }); \n    }\n\n    componentDidUpdate(prevProps) {\n        if (!map || !map.getSource('osm')) {\n            return;\n        }\n\n        if (this.props.data !== prevProps.data) {\n            map.getSource('osm').setData(this.props.data);\n        }\n        \n        if (this.props.style !== prevProps.style) {\n            map.setStyle(this.props.style);\n        }\n        \n        // if (this.props.zoom !== prevProps.zoom) {\n        //     map.setZoom(this.props.zoom);\n        // }\n        \n        if (this.props.center !== prevProps.center) {\n            map.setCenter(this.props.center);\n        }\n        \n        // Compare only 'isActive' field of layers\n        if (this.props.layers.map(l => l.isActive).join() === prevProps.layers.map(l => l.isActive).join()) {\n            this.props.layers.forEach( l => {\n                map.setLayoutProperty(l.id, 'visibility', l.isActive ? 'visible' : 'none');\n                if (l.style.borderColor) {\n                    map.setLayoutProperty(l.id+'--border', 'visibility', l.isActive ? 'visible' : 'none');\n                }\n            })\n        }\n    }\n    \n    componentDidMount() {\n        this.reverseGeocode(this.props.center);\n\n        mapboxgl.accessToken = MAPBOX_ACCESS_TOKEN;\n        \n        map = new mapboxgl.Map({\n            container: this.mapContainer,\n            style: this.props.style,\n            center: this.props.center,\n            zoom: this.props.zoom\n        });\n\n        \n        // Native Mapbox map controls\n\n        const searchBar = new MapboxGeocoder({\n            accessToken: mapboxgl.accessToken,\n            mapboxgl: mapboxgl,\n            language: 'pt-br',\n            placeholder: 'Buscar endere√ßos, estabelecimentos, ...',\n            countries: 'br',\n            // collapsed: true\n        });\n        map.addControl(searchBar, 'bottom-right');\n\n        const cityPicker = new MapboxGeocoder({\n            accessToken: mapboxgl.accessToken,\n            mapboxgl: mapboxgl,\n            language: 'pt-br',\n            placeholder: 'Buscar cidades brasileiras',\n            countries: 'br',\n            types: 'place',\n            marker: false,\n            clearOnBlur: true\n        });\n        cityPicker.on('result', result => {\n            map.setMaxBounds(); \n\n            console.debug('geocoder result', result);\n            this.reverseGeocode(result.result.center);\n            document.querySelector('body').classList.remove('show-city-picker');\n            cityPicker.clear();\n        });\n        map.addControl(cityPicker, 'top-left');\n\n        map.addControl(\n            new mapboxgl.NavigationControl({\n                showCompass: false\n            }),\n            'bottom-right'\n        );\n        map.addControl(new mapboxgl.GeolocateControl({\n            positionOptions: {\n                enableHighAccuracy: true\n            },\n            trackUserLocation: true\n        }),\n            'bottom-right'\n        );\n        // map.addControl(new mapboxgl.FullscreenControl({ container: document.querySelector('body') }));\n\n\n        // Listeners\n\n        map.on('load', () => {\n            this.initLayers();\n            this.onMapMoved();\n\n            map.on('moveend', this.onMapMoved);\n\n            // Further chages on styles reinitilizes layers\n            map.on('style.load', () => {\n                this.initLayers();\n                this.onMapMoved();\n            });\n        });\n\n\n        popup = new mapboxgl.Popup({\n            closeOnClick: false\n        });\n        popup.on('close', e => {\n            if (selectedCycleway) {\n                map.setFeatureState({ source: 'osm', id: selectedCycleway }, { highlight: false });\n            }\n            selectedCycleway = null;\n        });\n    }\n\n    render() {\n        return (\n            // Thanks https://blog.mapbox.com/mapbox-gl-js-react-764da6cc074a\n            <div ref={el => this.mapContainer = el}></div>\n        )\n    }\n}\n\nexport default Map;","export const MAPBOX_ACCESS_TOKEN = 'pk.eyJ1IjoiY21kYWxiZW0iLCJhIjoiY2pnbXhjZnplMDJ6MjMzbnk0OGthZGE1ayJ9.n1flNO8ndRYKQcR9wNIT9w';\n\nexport const DEFAULT_BORDER_WIDTH = 3;\n\nexport const DEFAULT_AREA = 'Niter√≥i, Rio De Janeiro, Brazil';\nexport const DEFAULT_LNG = -43.1098110;\nexport const DEFAULT_LAT = -22.8948963;\n\nconst ONE_DAY_MS = 1000 * 60 * 60 * 24;\nexport const OSM_DATA_MAX_AGE_MS = 7 * ONE_DAY_MS;\n\nexport const MIN_ZOOM_TO_LOAD_DATA = 10;\n\nexport const TOPBAR_HEIGHT = 64;","import React, { Component } from 'react';\n\nimport './Spinner.css'\n\nclass Spinner extends Component {\n    render() {\n        const parts = this.props.area.split(',');\n        const city = parts[0];\n            // state = parts[1],\n            // country = parts[2];\n\n        return (\n            <div id=\"spinner\" className=\"loader-container\">\n                <div className=\"loader\">\n                    {\n                        this.props.error ?\n                            <div>\n                                <div style={{fontSize: '42px'}}>\n                                    <span role=\"img\" aria-label=\"Emoji triste\">üòì</span>\n                                </div>\n\n                                <div className=\"content\">\n                                    <h2>\n                                        Ops!\n                                    </h2>\n\n                                    <div>\n                                        O OSM est√° mal humorado neste momento. Atualize a p√°gina para tentar denovo.\n                                    </div>\n                                </div>\n                            </div>\n                            :\n                            <div>\n                                <svg className=\"spinnersvg\" viewBox='25 25 50 50'>\n                                    <circle className=\"path\" cx='50' cy='50' r='20' fill='none' strokeWidth='6' strokeMiterlimit='10'\n                                    />\n                                </svg>\n\n                                <div className=\"content\">\n                                    <h2>\n                                        Carregando mapa ciclovi√°rio de <b>{city}</b>.\n                                    </h2>\n\n                                    <div>\n                                        Como √© a primeira vez que voc√™ carrega esta cidade pode demorar um pouquinho :)\n                                    </div>\n                                </div>\n                            </div>\n\n                    }\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default Spinner;","import React, { Component } from 'react';\n\nimport './CitySwitcherBackdrop.css'\n\nimport { Button, Icon } from 'antd';\n\n\nclass CitySwitcherBackdrop extends Component {\n    onClose() {\n        let body = document.querySelector('body');\n        body.classList.remove('show-city-picker')\n    }\n\n    render() {\n        return (\n            <div id=\"backdrop\" onClick={this.onClose}>\n                <Button\n                    id=\"closeBtn\"\n                    // ghost\n                    // shape=\"circle\"\n                    // icon=\"close\"\n                    type=\"link\"\n                    size=\"large\"\n                    onClick={this.onClose}\n                >\n                    Cancelar\n                </Button>\n            </div>\n        )\n    }\n}\n\nexport default CitySwitcherBackdrop;","import React, { Component } from 'react';\n\nimport { TOPBAR_HEIGHT } from './constants'\n\nimport { Modal, Button, Divider, Popover, Icon } from 'antd';\n\nimport { get, set } from 'idb-keyval';\n\nimport itdp from './img/itdp.png';\nimport ucb from './img/ucb.png';\n\nimport './TopBar.css'\n\nclass TopBar extends Component {\n    info() {\n        Modal.info({\n            title: 'Sobre',\n            className: 'about-modal',\n            content: (\n                <div>\n                    <p>\n                        A plataforma CicloMapa √© uma ferramenta que buscar ampliar a visibilidade das infraestruturas ciclovi√°rias mapeadas no OpenStreetMap e engajar uma comunidade de mapeadores para atualiza√ß√£o colaborativa de dados e incid√™ncia em pol√≠ticas p√∫blicas de mobilidade urbana.\n                    </p>\n\n                    <p>\n                        Este √© um projeto Open Source, e seu c√≥digo pode ser encontrado no <a href=\"https://github.com/cmdalbem/ciclomapa/\">GitHub</a>.\n                    </p>\n\n                    <div>\n                        Apoio:\n\n                        <div className=\"logos\">\n                            <a href=\"http://itdpbrasil.org\" target=\"_BLANK\" rel=\"noopener noreferrer\">\n                                <img src={itdp} alt=\"Logo do ITDP\"></img>\n                            </a>\n                            <a href=\"https://www.uniaodeciclistas.org.br/\" target=\"_BLANK\" rel=\"noopener noreferrer\">\n                                <img src={ucb} alt=\"Logo da UCB\"></img>\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            ),\n            onOk() { },\n        });\n    }\n\n    showCityPicker() {\n        let body = document.querySelector('body');\n        body.classList.add('show-city-picker');\n        body.querySelector('.mapboxgl-ctrl-top-left .mapboxgl-ctrl-geocoder input').focus();\n    }\n\n    componentDidMount() {\n        get('hasSeenWelcomeMsg')\n                .then(data => {\n                    if (!data) {\n                        this.info();\n                        set('hasSeenWelcomeMsg', true);\n                    }\n                });\n    }\n\n    render() {\n        const parts = this.props.title.split(',');\n        const city = parts[0], \n            state = parts[1];\n            // country = parts[2];\n        let updatedAt;\n\n        // Super special case for Brasilia because it's so damn big and we're not loading the data into memory\n        const isDownloadUnavailable = city === 'Bras√≠lia';\n        \n        if (this.props.lastUpdate) {\n            updatedAt = this.props.lastUpdate.toLocaleString('pt-BR');\n        }\n        \n        return (\n            <div className=\"topbar\" style={{height: TOPBAR_HEIGHT}}>\n                <div>\n                    <h1 className=\"logo\">\n                        CicloMapa\n                    </h1>\n                </div>\n\n                <div>\n                    <Button \n                        size=\"large\"\n                        onClick={this.showCityPicker}\n                    >\n                        <h3 className=\"areaname\">\n                            <span className=\"state\">\n                                {state}\n                            </span>\n                            <span className=\"city\">\n                                {city}\n                            </span> \n\n                            <Icon\n                                type=\"down\"\n                                size=\"small\"\n                                style={{ fontSize: '16px', color: '#4ba96e' }}\n                            >\n                            </Icon>\n                        </h3>\n                    </Button>\n\n                    {\n                        updatedAt &&\n                        <Popover\n                            placement=\"bottom\"\n                            content={(\n                                <div>\n                                    Dados obtidos do OpenStreetMaps em <b>{updatedAt}</b>.\n                                    <Button\n                                        size=\"small\"\n                                        icon=\"redo\"\n                                        onClick={this.props.forceUpdate}\n                                        style={{marginLeft: '0.25em'}}\n                                    >\n                                    </Button>\n                                </div>\n                            )}\n                            arrowPointAtCenter={true}\n                        >\n                            <Icon type=\"info-circle\" style={{ marginLeft: '8px' }}/>\n                        </Popover>\n                    }\n                </div>\n                \n                <div>\n                    <Button\n                        size=\"large\"\n                        type=\"link\"\n                        onClick={this.info}\n                    >\n                        Sobre\n                    </Button>\n\n                    <Divider type=\"vertical\" />\n\n                    <Button\n                        size=\"large\"\n                        type=\"link\"\n                        onClick={this.props.downloadData}\n                        disabled={isDownloadUnavailable}\n                        style={{ opacity: isDownloadUnavailable ? .5 : 1}}\n                    >\n                        <Icon type=\"download\" /> Baixar dados\n                    </Button>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default TopBar;","import React, { Component } from 'react';\n\nimport light from './img/light.png';\nimport normal from './img/normal.png';\nimport satelite from './img/satelite.png';\n\nimport './MapStyleSwitcher.css'\n\nclass MapStyleSwitcher extends Component {\n    state = { selected: 0 };\n\n    options = [\n        {\n            img: normal,\n            // url: 'mapbox://styles/mapbox/streets-v11'\n            url: 'mapbox://styles/cmdalbem/cjgmxgkbw000n2rqtucat5zjz'\n        },\n        {\n            img: light,\n            url: 'mapbox://styles/cmdalbem/cjxseldep7c0a1doc7ezn6aeb'\n        },\n        {\n            img: satelite,\n            url: 'mapbox://styles/cmdalbem/cjxsdwb907bfi1cqevxio2bst'\n        },\n    ];\n\n    componentDidUpdate(prevProps, prevState) {\n        if (this.state !== prevState) {\n            const selected = this.options[this.state.selected]\n            this.props.onMapStyleChange(selected.url)\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"switcher-bar\">\n                {\n                    this.options.map( (option, i) =>\n                        <div\n                            onClick={() => this.setState({ selected: i })}\n                            className={this.state.selected === i ? 'selected' : ''}\n                            key={option.img}\n                        >\n                            <img src={option.img} alt=\"\"/>\n                        </div>\n                    )\n                }\n            </div>\n        )\n    }\n}\n\nexport default MapStyleSwitcher;","import React, { Component } from 'react';\n\nimport { Switch, Tooltip } from 'antd';\n\nimport './LayersPanel.css';\n\n\nclass LayersPanel extends Component {\n    onChange(id, newVal) {\n        this.props.onLayersChange(id, newVal)\n    }\n\n    render() {\n        return (\n            <div className=\"layers-panel\">\n                {\n                    this.props.layers &&\n                    this.props.layers.map(l =>\n                        <Tooltip\n                            placement=\"left\"\n                            title={l.description}\n                            arrowPointAtCenter={true}\n                            key={l.name}\n                        >\n                            <div\n                                className=\"layer-row\"\n                                onClick={this.onChange.bind(this, l.id, !l.isActive)}\n                            >\n                                <div>\n                                    <span\n                                        className=\"layer-miniature\" \n                                        style={{\n                                            height: l.style.lineWidth * 2,\n                                            background: l.style.lineStyle === 'solid' ?\n                                                l.style.lineColor\n                                                : `repeating-linear-gradient(90deg, ${l.style.lineColor}, ${l.style.lineColor} 3px, white 3px, white 6px)`,\n                                            borderColor: l.style.borderColor,\n                                            borderStyle: l.style.borderStyle,\n                                            borderWidth: l.style.borderWidth ? l.style.borderWidth/2 : '0',\n                                            borderLeft: 'none',\n                                            borderRight: 'none'\n                                    }}\n                                    ></span>\n\n                                    <span className=\"layer-name\">\n                                        {l.name}\n                                    </span>\n                                </div>\n\n                                <Switch size=\"small\" checked={l.isActive}/>\n                            </div>\n                        </Tooltip>\n                    )\n                }\n            </div>\n        )\n    }\n}\n\nexport default LayersPanel;","import { saveAs } from 'file-saver';\n\n\nexport function doesAContainsB(a, b) {\n    if (a && b) {\n        return a.getNorth() >= b.getNorth()\n            && a.getSouth() <= b.getSouth()\n            && a.getEast() >= b.getEast()\n            && a.getWest() <= b.getWest();\n    } else {\n        return null;\n    }\n}\n\n// Thanks https://stackoverflow.com/questions/19721439/download-json-object-as-a-file-from-browser\nexport function downloadObjectAsJson(data, fileName) {\n    const blob = new Blob([JSON.stringify(data)], {\n        type: 'application/json',\n        name: fileName\n    }); \n    saveAs(blob, fileName);\n}\n\nexport function createPolygonFromBBox(bbox) {\n    return {\n        'type': 'Feature',\n        'geometry': {\n            'type': 'Polygon',\n            'coordinates': [\n                [\n                    bbox.getNorthWest().toArray(),\n                    bbox.getNorthEast().toArray(),\n                    bbox.getSouthEast().toArray(),\n                    bbox.getSouthWest().toArray(),\n                    bbox.getNorthWest().toArray()\n                ]\n            ]\n        }\n    };\n}\n\n// Thanks https://medium.com/@mhagemann/the-ultimate-way-to-slugify-a-url-string-in-javascript-b8e4a0d849e1\nexport function slugify(str) {\n  const a = '√†√°√§√¢√£√•ƒÉ√¶√ß√®√©√´√™«µ·∏ß√¨√≠√Ø√Æ·∏ø≈Ñ«π√±√≤√≥√∂√¥≈ì√∏·πï≈ï√ü≈õ»ô»õ√π√∫√º√ª«ò·∫É·∫ç√ø≈∫¬∑/_,:;'\n  const b = 'aaaaaaaaceeeeghiiiimnnnooooooprssstuuuuuwxyz------'\n  const p = new RegExp(a.split('').join('|'), 'g')\n  return str.toString().toLowerCase()\n    .replace(/\\s+/g, '-') // Replace spaces with -\n    .replace(p, c => b.charAt(a.indexOf(c))) // Replace special characters\n    .replace(/&/g, '-and-') // Replace & with ‚Äòand‚Äô\n    .replace(/[^\\w-]+/g, '') // Remove all non-word characters\n    .replace(/--+/g, '-') // Replace multiple - with single -\n    .replace(/^-+/, '') // Trim - from start of text\n    .replace(/-+$/, '') // Trim - from end of text\n}\n\nconst typeSizes = {\n    \"undefined\": () => 0,\n    \"boolean\": () => 4,\n    \"number\": () => 8,\n    \"string\": item => 2 * item.length,\n    \"object\": item => !item ? 0 : Object\n        .keys(item)\n        .reduce((total, key) => sizeOf(key) + sizeOf(item[key]) + total, 0)\n};\n\nexport const sizeOf = value => typeSizes[typeof value](value);","/* eslint-disable no-loop-func */\nimport osmtogeojson from 'osmtogeojson'\n\nimport $ from 'jquery'\n\nimport { notification } from 'antd';\n\nimport { DEFAULT_BORDER_WIDTH } from './constants.js'\nimport { slugify } from './utils.js'\n\nimport * as layers from './layers.json';\n\nconst servers = [\n    'https://overpass.kumi.systems/api/interpreter',\n    'https://overpass-api.de/api/interpreter',\n    'http://overpass.openstreetmap.fr/api/interpreter',\n    'http://overpass.osm.ch/api/interpreter',\n    'https://overpass.nchc.org.tw'\n];\n\nclass OSMController {\n    static getQuery(constraints) {\n        const bbox = constraints.bbox;\n        // const area = constraints.area.split(',')[0];\n        const areaId = constraints.areaId;\n\n        const body = layers.default.map(l =>\n            l.filters.map(f =>\n                'way'\n                + (typeof f[0] === 'string' ?\n                    `[\"${f[0]}\"=\"${f[1]}\"]`\n                    :\n                    f.map(f_inner =>\n                        `[\"${f_inner[0]}\"=\"${f_inner[1]}\"]`\n                    ).join(\"\"))\n                 + (bbox ? \n                    `(${bbox});\\n`\n                    :\n                    `(area.a);\\n`)\n            ).join(\"\")\n        ).join(\"\");\n\n        return `\n            [out:json][timeout:500];\n            ${!bbox && `area(${areaId})->.a;`}\n            (\n                ${body}\n            );\n            out body geom;\n        `;\n    }\n\n    static massageLayersData() {\n        layers.default.forEach(l => {\n            // Omitted values\n            l.style.lineStyle = l.style.lineStyle || 'solid';\n            l.isActive = l.isActive !== undefined ? l.isActive : true;\n\n            if (l.style.borderColor) {\n                l.style.borderStyle = l.style.borderStyle || 'solid';\n                l.style.borderWidth = l.style.borderWidth || DEFAULT_BORDER_WIDTH;\n            }\n            \n            // Generate an ID based on name\n            l.id = slugify(l.name);\n        });\n\n        return layers.default;\n    }\n\n    static getLayers() {\n        return this.massageLayersData();\n    }\n\n    static getData(constraints) {\n        return new Promise((resolve, reject) => {\n            let geoJson;\n\n            $.getJSON(\n                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURI(constraints.area)}`,\n                nominatimData => {\n                    console.debug('nominatimData', nominatimData);\n\n                    // Source: https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL#By_area_.28area.29\n                    let areaId\n                    if (constraints.area === 'Vit√≥ria, Espirito Santo, Brazil') {\n                        areaId = 3601825817;\n                    } else {\n                        areaId = 3600000000 + nominatimData[0].osm_id;\n                    }\n\n                    const query = OSMController.getQuery({ areaId: areaId});\n                    \n                    console.debug('generated query: ', query);\n\n                    const encodedQuery = encodeURI(query);\n\n                    let requests = [];\n                    for (let i = 0; i < servers.length; i++) {\n                        const endpoint = servers[i] + '?data=' + encodedQuery;\n                        \n                        console.debug(i + ' OSM server: ' + servers[i]);\n\n                        requests[i] = $.getJSON(\n                            endpoint,\n                            data => {\n                                if (data.elements.length > 0) {\n                                    console.debug('SUCCESS! @ ' + i);\n                                    for (let r = 0; r < requests.length; r++) {\n                                        if (r !== i) {\n                                            console.debug('Aborting ' + r);\n                                            requests[r].abort();\n                                        }\n                                    }\n    \n                                    console.debug('osm data: ', data);\n                                    geoJson = osmtogeojson(data, { flatProperties: true });\n                                    console.debug('converted to geoJSON: ', geoJson);\n                                    \n                                    resolve({\n                                        geoJson: geoJson\n                                    });\n                                } else {\n                                    console.debug(`Server ${i} returned an empty result.`);\n\n                                    // Check if I'm the last one\n                                    let isLastRemainingRequest = true;\n                                    for (let r = 0; r < requests.length; r++) {\n                                        if (r !== i) {\n                                            if (requests[r].status === undefined) {\n                                                isLastRemainingRequest = false;\n                                            }\n                                        }\n                                    }\n                                    if (isLastRemainingRequest) {\n                                        console.debug('I was the last one, so probably the result is empty.');\n                                        resolve({ geoJson: null });\n                                    }\n                                }\n                            }).fail(e => {\n                                if (e.statusText !== 'abort') {\n                                    console.error(`Servidor ${i} deu erro:`, e);\n                                }\n                            });\n                    }\n                    \n                    // console.error(\"Deu erro! Saca s√≥:\", e);\n                    // notification['error']({\n                    //     message: 'Erro',\n                    //     description:\n                    //         `Ops, erro na API do Overpass (erro ${e.status}). Abra o console para ver mais detalhes.`,\n                    // });\n                    // reject();\n\n                }).fail(e => {\n                    console.error(\"Deu erro! Saca s√≥:\", e);\n                    notification['error']({\n                        message: 'Erro',\n                        description:\n                            'Ops, erro na API do Nominatim. Abra o console para ver mais detalhes.',\n                    });\n\n                    reject();\n                });\n        });\n    }\n}\n\nexport default OSMController;","import pako from 'pako';\n// import { gzip } from 'zlib';\n\nconst DEBUG = false;\n\n\nexport function gzipDecompress(data) {\n    return JSON.parse(pako.inflate(data), { to: 'string' });\n}\n\nexport function gzipCompress(data) {\n    const compressed = pako.deflate(JSON.stringify(data), { to: 'string' });\n\n    // Test if compression went OK\n    // const decompressed = JSON.parse(pako.inflate(compressed), { to: 'string' });\n    // console.log(decompressed);\n\n    return compressed;\n}\n\nexport function cleanUpOSMTags(data) {\n    data.features.forEach(feature => {\n        Object.keys(feature.properties).forEach(propertyKey => {\n            if (propertyKey !== 'id' &&\n                propertyKey !== 'name' &&\n                propertyKey !== 'type')\n                delete feature.properties[propertyKey];\n        });\n    });\n}\n\nexport function computeTypologies(data, layers) {\n    data.features.forEach(feature => {\n        if (DEBUG) {\n            console.debug(`${feature.properties.id} (${feature.properties.name})`);\n        }\n\n        if (!feature.properties.type) {\n            layers.forEach(layer => {\n                let match = false;\n                layer.filters.forEach(filter => {\n                    let partsToMatch;\n                    if (typeof filter[0] === 'object') {\n                        partsToMatch = [false, false];\n                    } else {\n                        partsToMatch = [false];\n                    }\n\n                    Object.keys(feature.properties).forEach(propertyKey => {\n                        if (typeof filter[0] === 'object') {\n                            if ((propertyKey === filter[0][0] &&\n                                feature.properties[propertyKey] === filter[0][1])) {\n                                partsToMatch[0] = true;\n                            }\n\n                            if ((propertyKey === filter[1][0] &&\n                                feature.properties[propertyKey] === filter[1][1])) {\n                                partsToMatch[1] = true;\n                            }\n                        } else {\n                            if ((propertyKey === filter[0] &&\n                                feature.properties[propertyKey] === filter[1])) {\n                                partsToMatch[0] = true;\n                            }\n                        }\n                    });\n\n                    if ((typeof filter[0] === 'object' && partsToMatch[0] && partsToMatch[1])\n                        || partsToMatch[0]) {\n                        feature.properties.type = layer.name;\n                        match = true;\n                        // console.debug(`.  .  ‚Üí ${feature.properties.name} (${feature.properties.id}) = ${layer.name}`);\n                    }\n\n                    // console.debug(`.  .  ${filter} ${match ? '‚úì' : ''}`);\n                });\n\n                if (DEBUG) {\n                    console.debug(`.  ${layer.name} ${match ? 'üëç' : ''}`);\n                }\n            });\n        }\n    });\n}","import { get, set } from 'idb-keyval';\n\nimport firebase from 'firebase';\n\nimport { slugify, sizeOf } from './utils.js'\nimport { cleanUpOSMTags, gzipCompress } from './geojsonUtils.js'\n\n\nconst DISABLE_LOCAL_STORAGE = true;\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyDUbMY3UuyJ9vVVBblhUR9L1B3TV6a3eRU\",\n    authDomain: \"ciclomapa-app.firebaseapp.com\",\n    databaseURL: \"https://ciclomapa-app.firebaseio.com\",\n    projectId: \"ciclomapa-app\",\n    storageBucket: \"ciclomapa-app.appspot.com\",\n    messagingSenderId: \"377722964538\",\n    appId: \"1:377722964538:web:bc0fada0b3db0587514303\"\n};\n\nclass Storage {\n    db;\n    buffer;\n    \n    constructor() {\n        firebase.initializeApp({\n            apiKey: firebaseConfig.apiKey,\n            authDomain: firebaseConfig.authDomain,\n            projectId: firebaseConfig.projectId\n        });\n\n        this.db = firebase.firestore();\n\n        this.db.collection(\"cities\").get().then((querySnapshot) => {\n            console.debug('[Firestore] Documents found:');\n            querySnapshot.forEach((doc) => {\n                console.debug('‚Ä¢ ' + doc.id);\n            });\n        });\n    }\n\n    compressJson(data) {\n        console.debug('Before: ', sizeOf(data));\n\n        // Minimize size by cleaning clearing OSM tags\n        // @todo DOESNT WORK because Mapbox needs the OSM tags to render the layers\n        // cleanUpOSMTags(data);\n        \n        // Compress with gzip\n        const compressed = gzipCompress(data);\n\n        console.debug('After: ', sizeOf(compressed));\n\n        return compressed;\n    }\n\n    saveToFirestore(name, jsonStr, updatedAt, part) {\n        let slug = slugify(name);\n\n        if (part === 2) {\n            slug += 2;\n        }\n\n        return this.db.collection('cities').doc(slug).set({\n            name: name,\n            geoJson: jsonStr,\n            updatedAt: updatedAt,\n            part: part || ''\n        });\n    }\n\n    save(name, geoJson, updatedAt) {\n        // Save to Local Storage\n        set(name, {\n            geoJson: geoJson,\n            updatedAt: updatedAt\n        });\n\n        // Save to Firestore\n        try {\n            const jsonStr = JSON.stringify(geoJson);\n\n            // geoJson = this.compressJson(geoJson);\n            this.saveToFirestore(name, jsonStr, updatedAt)\n                .then(() => {\n                    console.debug(\"[Firebase] Document written successfully.\");\n                }).catch(error => {\n                    // console.error(\"[Firebase] Error adding document: \", error);\n                    console.debug('[Firestore] Failed saving full data, splitting in 2...')\n\n                    const part1 = jsonStr.slice(0, Math.ceil(jsonStr.length/2));\n                    const part2 = jsonStr.slice(Math.ceil(jsonStr.length/2));\n\n                    this.saveToFirestore(name, part1, updatedAt, 1) \n                    .then(() => {\n                        console.debug(\"[Firebase] Document written successfully.\");\n                    }).catch(error => {\n                        console.error(\"[Firebase] Error adding document: \", error);\n                    });        \n \n                    this.saveToFirestore(name, part2, updatedAt, 2)\n                    .then(() => {\n                        console.debug(\"[Firebase] Document written successfully.\");\n                    }).catch(error => {\n                        console.error(\"[Firebase] Error adding document: \", error);\n                    });        \n\n                });\n        } catch (e) {\n            console.error(e);\n        }\n    }\n\n    getDataFromDB(slug, resolve, reject) {\n        this.db.collection(\"cities\").doc(slug).get().then(doc => {\n            if (doc.exists) {\n                let data = doc.data();\n\n                console.debug(\"[Firebase] Document data:\", data);\n\n                // Decompress gzip\n                // data.geoJson = gzipDecompress(data.geoJson)\n\n                if (data.part === 1) {\n                    this.buffer = data.geoJson; \n                    return this.getDataFromDB(slug + '2', resolve, reject);\n                } else if (data.part === 2) {\n                    data.geoJson = this.buffer + data.geoJson;\n                }\n\n                // Massage data\n                data.geoJson = JSON.parse(data.geoJson);\n                data.updatedAt = data.updatedAt.toDate();\n\n                resolve(data);\n            } else {\n                console.debug(\"[Firebase] No document for: \", slug);\n                resolve();\n            }\n        }).catch(error => {\n            console.error(`[Firebase] Error getting document: ${slug}`, error);\n            reject();\n        });\n    }\n\n    load(name) {\n        const slug = slugify(name);\n\n        return new Promise((resolve, reject) => {\n            if (!DISABLE_LOCAL_STORAGE) {\n                get(name).then( local => {\n                    if (local) {\n                        resolve(local);\n                    } else {\n                        this.getDataFromDB(slug, resolve, reject);\n                    }\n                })\n            } else {\n                this.getDataFromDB(slug, resolve, reject);\n            }\n        });\n    }\n}\n\nexport default Storage;","import React, { Component } from 'react';\nimport { withRouter } from \"react-router-dom\";\n\nimport { notification } from 'antd';\nimport \"antd/dist/antd.css\";\n\nimport Map from './Map.js'\nimport Spinner from './Spinner.js'\nimport CitySwitcherBackdrop from './CitySwitcherBackdrop.js'\nimport TopBar from './TopBar.js'\nimport MapStyleSwitcher from './MapStyleSwitcher.js'\nimport LayersPanel from './LayersPanel.js'\nimport OSMController from './OSMController.js'\nimport Storage from './Storage.js'\nimport { DEFAULT_LAT, DEFAULT_LNG, OSM_DATA_MAX_AGE_MS } from './constants.js'\nimport { downloadObjectAsJson } from './utils.js'\nimport { computeTypologies, cleanUpOSMTags } from './geojsonUtils.js'\n\nimport './App.css';\n\nclass App extends Component {\n    geoJson;\n    storage;\n\n    constructor(props) {\n        super(props);\n\n        this.updateData = this.updateData.bind(this);\n        this.onMapStyleChange = this.onMapStyleChange.bind(this);\n        this.onMapMoved = this.onMapMoved.bind(this);\n        this.onLayersChange = this.onLayersChange.bind(this);\n        this.downloadData = this.downloadData.bind(this);\n        this.forceUpdate = this.forceUpdate.bind(this);\n\n        const urlParams = this.getParamsFromURL();\n        this.state = {\n            geoJson: null,\n            loading: false,\n            layers: OSMController.getLayers(),\n            mapStyle: 'mapbox://styles/cmdalbem/cjgmxgkbw000n2rqtucat5zjz',\n            zoom: urlParams.z || 13,\n            area: '',\n            center: [\n                parseFloat(urlParams.lng) || DEFAULT_LNG,\n                parseFloat(urlParams.lat) || DEFAULT_LAT]\n        };\n\n        this.storage = new Storage();\n\n        if (this.state.area) {\n            this.updateData();\n        }\n    }\n\n    getParamsFromURL() {\n        const possibleParams = ['z', 'lat', 'lng'];\n        const urlParams = new URLSearchParams(this.props.location.search);\n        let paramsObj = {}\n\n        possibleParams.forEach( p => {\n            let value = urlParams.get(p);\n            if (value) {\n                paramsObj[p] = value;\n            }\n        })\n\n        return paramsObj;\n    }\n\n    isDataFresh(data) {\n        const now = new Date();\n        const dataLastUpdate = new Date(data.updatedAt);\n\n        return now - dataLastUpdate < OSM_DATA_MAX_AGE_MS;\n    }\n\n    forceUpdate() {\n        this.updateData(true);\n    }\n\n    getDataFromOSM(area) {\n        OSMController.getData({ area: area })\n            .then(data => {\n                // Persist data\n                const now = new Date();\n                this.storage.save(area, data.geoJson, now);\n\n                this.setState({\n                    geoJson: data.geoJson,\n                    dataUpdatedAt: now,\n                    loading: false\n                });\n            }).catch(e => {\n                this.setState({\n                    error: true\n                });\n            });\n    }\n\n    updateData(force) {\n        if (this.state.area) {\n            if (force) {\n                this.setState({ loading: true });\n                this.getDataFromOSM(this.state.area);\n            } else if (this.state.area === 'Bras√≠lia, Distrito Federal, Brazil'){\n                // Super special case for Brasilia because it's so damn big\n                //   More at: https://docs.mapbox.com/help/troubleshooting/working-with-large-geojson-data/#store-geojson-at-url\n                this.setState({\n                    geoJson: './ciclomapa-brasilia.geojson',\n                    dataUpdatedAt: new Date('Sun Sep 29 2019 19:04:25 GMT-0300 (Brasilia Standard Time)')\n                });\n            } else {\n                // Try to retrieve previously saved data for this area\n                this.storage.load(this.state.area, force)\n                    .then(data => {\n                        if (data && this.isDataFresh(data)) {\n                            console.debug('Database data is fresh.');\n                            this.setState({\n                                geoJson: data.geoJson,\n                                dataUpdatedAt: new Date(data.updatedAt)\n                            });\n                        } else { \n                            console.debug(`Couldn't find data for area ${this.state.area} or it isn't fresh, hitting OSM...`);\n                            this.setState({ loading: true });\n                            this.getDataFromOSM(this.state.area);\n                        }\n                    }).catch(e => {\n                        notification['error']({\n                            message: 'Erro',\n                            description:\n                                'Ocorreu um erro ao acessar o banco de dados.',\n                        });\n                    });\n            }\n        } else {\n            this.setState({ loading: false });\n        }\n    }\n\n    onMapStyleChange(newMapStyle) {\n        this.setState({ mapStyle: newMapStyle});\n    }\n\n    onLayersChange(id, newVal) {\n        let newLayers = Object.assign([], this.state.layers);\n        let modifiedLayer = newLayers.filter(l => l.id === id)[0];\n        modifiedLayer.isActive = newVal;\n\n        this.setState({ layers: newLayers });\n    }\n\n    downloadData() {\n        computeTypologies(this.state.geoJson, this.state.layers);\n        cleanUpOSMTags(this.state.geoJson);\n        downloadObjectAsJson(this.state.geoJson, `ciclomapa-${this.state.area}`);\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        if (this.props.location !== prevProps.location) {\n            this.onRouteChanged();\n        }\n\n        if (this.state.area !== prevState.area) {\n            console.debug(`Changed area from ${prevState.area} to ${this.state.area}`);\n            \n            this.updateData();\n\n            // Only redo the query if we need new data\n            // if (!doesAContainsB(largestBoundsYet, newBounds)) {\n            //     this.updateData();\n            //     largestBoundsYet = newBounds;\n\n            //     if (DEBUG_BOUNDS_OPTIMIZATION) {\n            //         this.updateDebugPolygon(largestBoundsYet, 1);\n            //     }\n            // }\n        }\n\n        if (this.state.geoJson !== prevState.geoJson) {\n            if (!this.state.geoJson || (this.state.geoJson.features && this.state.geoJson.features.length === 0)) {\n                notification['warning']({\n                    message: 'Ops',\n                    description:\n                        'N√£o h√° dados ciclovi√°rios para esta cidade.',\n                });\n\n                // this.setState({\n                //     isDownloadUnavailable: true\n                // });\n            } else {\n                // this.setState({\n                //     isDownloadUnavailable: false\n                // });\n            }\n        }\n        \n        if (this.state.zoom !== prevState.zoom ||\n            this.state.lat !== prevState.lat ||\n            this.state.lng !== prevState.lng) {\n                let params = '?';\n                params += `lat=${this.state.lat.toFixed(7)}`;\n                params += `&lng=${this.state.lng.toFixed(7)}`;\n                params += `&z=${this.state.zoom.toFixed(2)}`;\n                this.props.history.push({\n                    search: params\n                })\n        }\n    }\n\n    onRouteChanged() {\n        // @todo Fix infinite loop\n        // this.setState(this.getParamsFromURL());\n    }\n\n    onMapMoved(newState) {\n        // Ignore new area changes from Map\n        // if (this.state.area) {\n        //     delete newState.area;\n        // }\n\n        this.setState(newState);\n    }\n\n    render() {\n        return (\n            <div>\n                <TopBar\n                    title={this.state.area}\n                    lastUpdate={this.state.dataUpdatedAt}\n                    downloadData={this.downloadData}\n                    // isDownloadUnavailable={this.state.isDownloadUnavailable}\n                    onMapMoved={this.onMapMoved}\n                    forceUpdate={this.forceUpdate}\n                />\n\n                <CitySwitcherBackdrop/>\n\n                <Map\n                    data={this.state.geoJson}\n                    layers={this.state.layers}\n                    style={this.state.mapStyle}\n                    zoom={this.state.zoom}\n                    center={this.state.center}\n                    updateData={this.updateData}\n                    onMapMoved={this.onMapMoved}\n                />\n\n                <MapStyleSwitcher onMapStyleChange={this.onMapStyleChange}/>\n \n                <LayersPanel\n                    layers={this.state.layers}\n                    onLayersChange={this.onLayersChange}\n                />\n\n                {\n                    this.state.loading &&\n                    <Spinner area={this.state.area} error={this.state.error}/>\n                }\n            </div>\n        );\n    }\n}\n\nexport default withRouter(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { BrowserRouter as Router } from \"react-router-dom\";\n\nReactDOM.render(\n  <Router>\n    <App />\n  </Router>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();"],"sourceRoot":""}